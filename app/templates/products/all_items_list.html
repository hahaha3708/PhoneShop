{% extends "base.html" %}
{% load static %}
{% load currency %}

{% block title %}Tất cả sản phẩm{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/all-items.css' %}">
{% endblock %}

{% block content %}
<div class="container-xxl my-3 all-items">
  <div class="row g-4">
    <!-- SIDEBAR -->
    <aside class="col-lg-3">
      <div class="card border-0 shadow-sm rounded-4 sticky-top" style="top:92px">
        <div class="card-body p-3 p-sm-4">
          <div class="d-flex align-items-center justify-content-between mb-3">
            <h6 class="m-0 fw-semibold text-secondary">Danh mục</h6>
          </div>

          <div class="list-group list-group-clean mb-3">
            <a class="list-group-item active" href="{% url 'shop:all_items_list' %}">Tất cả</a>
          </div>

          <form method="get" action="{% url 'shop:all_items_list' %}" class="vstack gap-2 filter-form">
            <input name="q" value="{{ q }}" type="text" class="form-control form-control-sm"
                   placeholder="Tìm sản phẩm...">

            <select name="brand" class="form-select form-select-sm">
              <option value="">Tất cả hãng</option>
              {% for b in all_brands %}
                <option value="{{ b }}" {% if brand == b %}selected{% endif %}>{{ b }}</option>
              {% endfor %}
            </select>

            <select name="sort" class="form-select form-select-sm">
              <option value="">Mặc định</option>
              <option value="price_asc"  {% if sort == 'price_asc' %}selected{% endif %}>Giá tăng dần</option>
              <option value="price_desc" {% if sort == 'price_desc' %}selected{% endif %}>Giá giảm dần</option>
              <option value="newest"     {% if sort == 'newest' %}selected{% endif %}>Mới nhất</option>
            </select>

            <button class="btn btn-primary btn-sm w-100">Lọc</button>
          </form>
        </div>
      </div>
    </aside>

    <!-- GRID -->
    <section class="col-lg-9">
      <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3">
        {% for it in items %}
        <div class="col">
          {% if it.kind == 'phone' %}
            <a href="{% url 'shop:product_detail' it.slug %}" class="text-decoration-none text-dark">
          {% else %}
            <a href="{% url 'shop:accessory_detail' it.slug %}" class="text-decoration-none text-dark">
          {% endif %}
              <div class="card product-card h-100 border-0 shadow-sm">
                <!-- Hình ảnh -->
                <div class="thumb ratio ratio-1x1 position-relative">
                  <img loading="lazy" src="{{ it.image }}" alt="{{ it.name }}">
                  {% if it.discount_percent %}
                    <span class="badge bg-danger position-absolute top-0 start-0 m-2">
                      -{{ it.discount_percent }}%
                    </span>
                  {% endif %}
                </div>

                <!-- Nội dung -->
                <div class="card-body text-center">
                  <div class="brand small text-muted mb-1">{{ it.brand }}</div>
                  <h3 class="title h6 fw-semibold mb-2" title="{{ it.name }}">{{ it.name }}</h3>
                  <div class="price text-danger fw-bold">{{ it.final_price|vnd }}</div>
                </div>
              </div>
            </a>
        </div>
        {% empty %}
          <div class="col-12">
            <div class="alert alert-info mb-0">Không có sản phẩm phù hợp.</div>
          </div>
        {% endfor %}
      </div>

      {% if page_obj %}
      <nav class="mt-4">
        <ul class="pagination justify-content-center">
          {% if page_obj.has_previous %}
          <li class="page-item">
            <a class="page-link"
               href="?page={{ page_obj.previous_page_number }}&q={{ q }}&brand={{ brand }}&sort={{ sort }}">«</a>
          </li>
          {% endif %}
          <li class="page-item active">
            <span class="page-link">Trang {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>
          </li>
          {% if page_obj.has_next %}
          <li class="page-item">
            <a class="page-link"
               href="?page={{ page_obj.next_page_number }}&q={{ q }}&brand={{ brand }}&sort={{ sort }}">»</a>
          </li>
          {% endif %}
        </ul>
      </nav>
      {% endif %}
    </section>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/all-items.js' %}"></script>
{% endblock %}
